"use strict";(self.webpackChunktenzi_ts=self.webpackChunktenzi_ts||[]).push([[974],{4974:function(t,r,e){e.r(r),e.d(r,{MarketplaceV3:function(){return O}});var n=e(885),a=e(2982),s=e(4165),i=e(5861),c=e(5671),o=e(3144),u=e(8084),p=e(4456),d=e(874),f=e(5025),l=e(332),h=e(8455),v=e(2257),m=e(4029),g=e(8624),k=e(9601),x=e(4554),y=e(9242),w=(e(518),e(6219),e(8834),e(5660),e(1303),e(1497),e(4317),e(3670),e(9120),e(7604),e(8187),e(9362),e(9190),e(4730),e(6250),e(5725),e(8730),e(8507),e(8398),e(2090),e(6841),e(9561),e(580),e(246),e(4253),e(1559),e(553),e(26),e(9392),e(9526),e(4601),e(6878),e(7033),e(3058),e(5158),e(7761),e(583),e(2355),e(4194),e(1121),e(8613),e(2484),e(8435),e(4255),e(8528),e(2555),e(8281),e(2037),e(7437),e(9189),e(737),e(8262),e(4161),e(266),e(8839),e(1375),e(3320),e(5815),e(2378),e(5173),e(6315),d.z.object({assetContractAddress:p.cF,tokenId:p.cG,quantity:p.cG.default(1),currencyContractAddress:p.cF.default(p.c2),pricePerToken:u.A,startTimestamp:p.cH.default(new Date),endTimestamp:p.cI,isReservedListing:d.z.boolean().default(!1)})),b=function(){function t(r,e){(0,c.Z)(this,t),(0,u._)(this,"featureName",p.cJ.name),(0,u._)(this,"contractWrapper",void 0),(0,u._)(this,"storage",void 0),(0,u._)(this,"events",void 0),(0,u._)(this,"interceptor",void 0),(0,u._)(this,"encoder",void 0),this.contractWrapper=r,this.storage=e,this.events=new p.aM(this.contractWrapper),this.encoder=new p.aa(this.contractWrapper),this.interceptor=new p.aN(this.contractWrapper)}return(0,o.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.readContract.address}},{key:"getTotalCount",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.totalListings();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No listings exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllListings);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapListing(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No listings exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllValidListings);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapListing(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.getListing(r);case 2:return e=t.sent,t.next=5,this.mapListing(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isBuyerApprovedForListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:if(t.sent.isReservedListing){t.next=5;break}throw new Error("Listing ".concat(r," is not a reserved listing."));case 5:return t.next=7,this.contractWrapper.readContract.isBuyerApprovedForListing(r,e);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"isCurrencyApprovedForListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:return t.next=4,this.contractWrapper.readContract.isCurrencyApprovedForListing(r,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"currencyPriceForListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:if(n=t.sent,e!==n.currencyContractAddress){t.next=5;break}return t.abrupt("return",n.pricePerToken);case 5:return t.next=7,this.isCurrencyApprovedForListing(r,e);case 7:if(t.sent){t.next=10;break}throw new Error("Currency ".concat(e," is not approved for Listing ").concat(r,"."));case 10:return t.next=12,this.contractWrapper.readContract.currencyPriceForListing(r,e);case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"createListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=w.parse(r),t.t0=p.cL,t.t1=this.contractWrapper,t.t2=this.getAddress(),t.t3=e.assetContractAddress,t.t4=e.tokenId,t.next=8,this.contractWrapper.getSignerAddress();case 8:return t.t5=t.sent,t.next=11,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 11:return t.next=13,(0,p.a$)(this.contractWrapper.getProvider(),e.pricePerToken,e.currencyContractAddress);case 13:return n=t.sent,t.next=16,this.contractWrapper.getProvider().getBlock("latest");case 16:return a=t.sent,i=a.timestamp,e.startTimestamp.lt(i)&&(e.startTimestamp=v.O$.from(i)),t.next=21,this.contractWrapper.sendTransaction("createListing",[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:(0,p.cM)(e.currencyContractAddress),pricePerToken:n,startTimestamp:e.startTimestamp,endTimestamp:e.endTimestamp,reserved:e.isReservedListing}],{gasLimit:5e5});case 21:return c=t.sent,o=this.contractWrapper.parseLogs("NewListing",null===c||void 0===c?void 0:c.logs),t.abrupt("return",{id:o[0].args.listingId,receipt:c});case 24:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"updateListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n,a,i,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=w.parse(e),t.t0=p.cL,t.t1=this.contractWrapper,t.t2=this.getAddress(),t.t3=n.assetContractAddress,t.t4=n.tokenId,t.next=8,this.contractWrapper.getSignerAddress();case 8:return t.t5=t.sent,t.next=11,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 11:return t.next=13,(0,p.a$)(this.contractWrapper.getProvider(),n.pricePerToken,n.currencyContractAddress);case 13:return a=t.sent,t.next=16,this.contractWrapper.sendTransaction("updateListing",[r,{assetContract:n.assetContractAddress,tokenId:n.tokenId,quantity:n.quantity,currency:(0,p.cM)(n.currencyContractAddress),pricePerToken:a,startTimestamp:n.startTimestamp,endTimestamp:n.endTimestamp,reserved:n.isReservedListing}],{gasLimit:5e5});case 16:return i=t.sent,c=this.contractWrapper.parseLogs("UpdatedListing",null===i||void 0===i?void 0:i.logs),t.abrupt("return",{id:c[0].args.listingId,receipt:i});case 19:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"cancelListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.sendTransaction("cancelListing",[r]);case 2:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 4:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"buyFromListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){var a,i,c,o,u,d,f,l;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:return a=t.sent,t.next=5,this.isStillValidListing(a,e);case 5:if(i=t.sent,c=i.valid,o=i.error,c){t.next=10;break}throw new Error("Listing ".concat(r," is no longer valid. ").concat(o));case 10:if(!n){t.next=14;break}t.t0=n,t.next=17;break;case 14:return t.next=16,this.contractWrapper.getSignerAddress();case 16:t.t0=t.sent;case 17:return u=t.t0,d=v.O$.from(e),f=v.O$.from(a.pricePerToken).mul(d),t.next=22,this.contractWrapper.getCallOverrides();case 22:if(t.t1=t.sent,t.t1){t.next=25;break}t.t1={};case 25:return l=t.t1,t.next=28,(0,p.cN)(this.contractWrapper,f,a.currencyContractAddress,l);case 28:return t.next=30,this.contractWrapper.sendTransaction("buyFromListing",[r,u,d,a.currencyContractAddress,f],l);case 30:return t.t2=t.sent,t.abrupt("return",{receipt:t.t2});case 32:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()},{key:"approveBuyerForReservedListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isBuyerApprovedForListing(r,e);case 2:if(t.sent){t.next=10;break}return t.next=6,this.contractWrapper.sendTransaction("approveBuyerForListing",[r,e,!0]);case 6:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 10:throw new Error("Buyer ".concat(e," already approved for listing ").concat(r,"."));case 11:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"revokeBuyerApprovalForReservedListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isBuyerApprovedForListing(r,e);case 2:if(!t.sent){t.next=10;break}return t.next=6,this.contractWrapper.sendTransaction("approveBuyerForListing",[r,e,!1]);case 6:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 10:throw new Error("Buyer ".concat(e," not approved for listing ").concat(r,"."));case 11:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"approveCurrencyForListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){var a,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:return a=t.sent,e===a.currencyContractAddress&&(0,x.Z)(n===a.pricePerToken,"Approving listing currency with a different price."),t.next=6,this.contractWrapper.readContract.currencyPriceForListing(r,e);case 6:return i=t.sent,(0,x.Z)(n===i,"Currency already approved with this price."),t.next=10,this.contractWrapper.sendTransaction("approveCurrencyForListing",[r,e,n]);case 10:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 12:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()},{key:"revokeCurrencyApprovalForListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(v.O$.from(r));case 2:if(n=t.sent,e!==n.currencyContractAddress){t.next=5;break}throw new Error("Can't revoke approval for main listing currency.");case 5:return t.next=7,this.contractWrapper.readContract.currencyPriceForListing(r,e);case 7:return a=t.sent,(0,x.Z)(!a.isZero(),"Currency not approved."),t.next=11,this.contractWrapper.sendTransaction("approveCurrencyForListing",[r,e,v.O$.from(0)]);case 11:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 13:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=p.aV.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=v.O$.from(r.startTimestamp).gt(a)?p.aV.Created:v.O$.from(r.endTimestamp).lt(a)?p.aV.Expired:p.aV.Active,t.abrupt("break",14);case 10:return e=p.aV.Completed,t.abrupt("break",14);case 12:return e=p.aV.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.assetContract,t.t2=r.currency,t.t3=r.pricePerToken.toString(),t.next=19,(0,p.aZ)(this.contractWrapper.getProvider(),r.currency,r.pricePerToken);case 19:return t.t4=t.sent,t.t5=r.listingId.toString(),t.t6=r.tokenId.toString(),t.t7=r.quantity.toString(),t.t8=v.O$.from(r.startTimestamp).toNumber(),t.next=26,(0,p.cO)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 26:return t.t9=t.sent,t.t10=v.O$.from(r.endTimestamp).toNumber(),t.t11=r.listingCreator,t.t12=r.reserved,t.t13=e,t.abrupt("return",{assetContractAddress:t.t1,currencyContractAddress:t.t2,pricePerToken:t.t3,currencyValuePerToken:t.t4,id:t.t5,tokenId:t.t6,quantity:t.t7,startTimeInSeconds:t.t8,asset:t.t9,endTimeInSeconds:t.t10,creatorAddress:t.t11,isReservedListing:t.t12,status:t.t13});case 32:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n,a,i,c,o,u,d,v,g;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,p.cP)(this.contractWrapper.getProvider(),this.getAddress(),r.assetContractAddress,r.tokenId,r.creatorAddress);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",{valid:!1,error:"Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress,"' is not approved for transfer")});case 5:return n=this.contractWrapper.getProvider(),a=new m.CH(r.assetContractAddress,f,n),t.next=9,a.supportsInterface(p.c0);case 9:return i=t.sent,t.next=12,a.supportsInterface(p.c1);case 12:if(c=t.sent,!i){t.next=23;break}return o=new m.CH(r.assetContractAddress,l,n),t.next=17,o.ownerOf(r.tokenId);case 17:return t.t0=t.sent.toLowerCase(),t.t1=r.creatorAddress.toLowerCase(),u=t.t0===t.t1,t.abrupt("return",{valid:u,error:u?void 0:"Seller is not the owner of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," anymore'")});case 23:if(!c){t.next=32;break}return d=new m.CH(r.assetContractAddress,h,n),t.next=27,d.balanceOf(r.creatorAddress,r.tokenId);case 27:return v=t.sent,g=v.gte(e||r.quantity),t.abrupt("return",{valid:g,error:g?void 0:"Seller does not have enough balance of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," to fulfill the listing")});case 32:return t.abrupt("return",{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."});case 33:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(t,r){var e=(0,a.Z)(t);return r&&(r.seller&&(e=e.filter((function(t){var e;return t.listingCreator.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.seller)||void 0===e?void 0:e.toString().toLowerCase())}))),r.tokenContract&&(e=e.filter((function(t){var e;return t.assetContract.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.tokenContract)||void 0===e?void 0:e.toString().toLowerCase())}))),void 0!==r.tokenId&&(e=e.filter((function(t){var e;return t.tokenId.toString()===(null===r||void 0===r||null===(e=r.tokenId)||void 0===e?void 0:e.toString())})))),null!==r&&void 0!==r&&r.count&&r.count<e.length?e.slice(0,r.count):e}}]),t}(),Z=d.z.object({assetContractAddress:p.cF,tokenId:p.cG,quantity:p.cG.default(1),currencyContractAddress:p.cF.default(p.c2),minimumBidAmount:u.A,buyoutBidAmount:u.A,timeBufferInSeconds:p.cG.default(900),bidBufferBps:p.cG.default(500),startTimestamp:p.cH.default(new Date),endTimestamp:p.cI}),A=function(){function t(r,e){(0,c.Z)(this,t),(0,u._)(this,"featureName",p.cQ.name),(0,u._)(this,"contractWrapper",void 0),(0,u._)(this,"storage",void 0),(0,u._)(this,"events",void 0),(0,u._)(this,"interceptor",void 0),(0,u._)(this,"encoder",void 0),this.contractWrapper=r,this.storage=e,this.events=new p.aM(this.contractWrapper),this.encoder=new p.aa(r),this.interceptor=new p.aN(this.contractWrapper)}return(0,o.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.readContract.address}},{key:"getTotalCount",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.totalAuctions();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No auctions exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllAuctions);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapAuction(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No auctions exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllValidAuctions);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapAuction(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.getAuction(r);case 2:return e=t.sent,t.next=5,this.mapAuction(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinningBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return t.next=4,this.contractWrapper.readContract.getWinningBid(r);case 4:if((e=t.sent)._bidder!==g.d){t.next=7;break}return t.abrupt("return",void 0);case 7:return t.next=9,this.mapBid(r.toString(),e._bidder,e._currency,e._bidAmount.toString());case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isWinningBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.isNewWinningBid(r,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"getWinner",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return e=t.sent,t.next=5,this.contractWrapper.readContract.getWinningBid(r);case 5:if(n=t.sent,a=v.O$.from(Math.floor(Date.now()/1e3)),i=v.O$.from(e.endTimeInSeconds),!a.gt(i)||n._bidder===g.d){t.next=10;break}return t.abrupt("return",n._bidder);case 10:return t.next=12,this.contractWrapper.readContract.queryFilter(this.contractWrapper.readContract.filters.AuctionClosed());case 12:if(c=t.sent,o=c.find((function(t){return t.args.auctionId.eq(v.O$.from(r))}))){t.next=16;break}throw new Error("Could not find auction with ID ".concat(r," in closed auctions"));case 16:return t.abrupt("return",o.args.winningBidder);case 17:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"createAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Z.parse(r),t.t0=p.cL,t.t1=this.contractWrapper,t.t2=this.getAddress(),t.t3=e.assetContractAddress,t.t4=e.tokenId,t.next=8,this.contractWrapper.getSignerAddress();case 8:return t.t5=t.sent,t.next=11,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 11:return t.next=13,(0,p.a$)(this.contractWrapper.getProvider(),e.buyoutBidAmount,e.currencyContractAddress);case 13:return n=t.sent,t.next=16,(0,p.a$)(this.contractWrapper.getProvider(),e.minimumBidAmount,e.currencyContractAddress);case 16:return a=t.sent,t.next=19,this.contractWrapper.getProvider().getBlock("latest");case 19:return i=t.sent,c=i.timestamp,e.startTimestamp.lt(c)&&(e.startTimestamp=v.O$.from(c)),t.next=24,this.contractWrapper.sendTransaction("createAuction",[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:(0,p.cM)(e.currencyContractAddress),minimumBidAmount:a,buyoutBidAmount:n,timeBufferInSeconds:e.timeBufferInSeconds,bidBufferBps:e.bidBufferBps,startTimestamp:e.startTimestamp,endTimestamp:e.endTimestamp}],{gasLimit:5e5});case 24:return o=t.sent,u=this.contractWrapper.parseLogs("NewAuction",null===o||void 0===o?void 0:o.logs),t.abrupt("return",{id:u[0].args.auctionId,receipt:o});case 27:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"buyoutAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return e=t.sent,t.next=5,(0,p.a_)(this.contractWrapper.getProvider(),e.currencyContractAddress);case 5:return n=t.sent,t.abrupt("return",this.makeBid(r,k.bM(e.buyoutBidAmount,n.decimals)));case 7:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"makeBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n,a,i,c,o,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return n=t.sent,t.next=5,(0,p.a$)(this.contractWrapper.getProvider(),e,n.currencyContractAddress);case 5:if(!(a=t.sent).eq(v.O$.from(0))){t.next=8;break}throw new Error("Cannot make a bid with 0 value");case 8:if(!a.gt(n.buyoutBidAmount)){t.next=10;break}throw new Error("Bid amount must be less than or equal to buyoutBidAmount");case 10:return t.next=12,this.getWinningBid(r);case 12:if(!t.sent){t.next=20;break}return t.next=16,this.isWinningBid(r,a);case 16:i=t.sent,(0,x.Z)(i,"Bid price is too low based on the current winning bid and the bid buffer"),t.next=23;break;case 20:c=a,o=v.O$.from(n.minimumBidAmount),(0,x.Z)(c.gte(o),"Bid price is too low based on minimum bid amount");case 23:return t.next=25,this.contractWrapper.getCallOverrides();case 25:if(t.t0=t.sent,t.t0){t.next=28;break}t.t0={};case 28:return u=t.t0,t.next=31,(0,p.cN)(this.contractWrapper,a,n.currencyContractAddress,u);case 31:return t.next=33,this.contractWrapper.sendTransaction("bidInAuction",[r,a],u);case 33:return t.t1=t.sent,t.abrupt("return",{receipt:t.t1});case 35:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"cancelAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getWinningBid(r);case 2:if(!t.sent){t.next=5;break}throw new Error("Bids already made.");case 5:return t.next=7,this.contractWrapper.sendTransaction("cancelAuction",[r]);case 7:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 9:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"closeAuctionForBidder",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}return t.next=3,this.contractWrapper.getSignerAddress();case 3:e=t.sent;case 4:return t.next=6,this.validateAuction(v.O$.from(r));case 6:return n=t.sent,t.prev=7,t.next=10,this.contractWrapper.sendTransaction("collectAuctionTokens",[v.O$.from(r)]);case 10:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 14:if(t.prev=14,t.t1=t.catch(7),!t.t1.message.includes("Marketplace: auction still active.")){t.next=20;break}throw new p.bk(r.toString(),n.endTimeInSeconds.toString());case 20:throw t.t1;case 21:case"end":return t.stop()}}),t,this,[[7,14]])})));return function(r,e){return t.apply(this,arguments)}}()},{key:"closeAuctionForSeller",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return e=t.sent,t.prev=3,t.next=6,this.contractWrapper.sendTransaction("collectAuctionPayout",[v.O$.from(r)]);case 6:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 10:if(t.prev=10,t.t1=t.catch(3),!t.t1.message.includes("Marketplace: auction still active.")){t.next=16;break}throw new p.bk(r.toString(),e.endTimeInSeconds.toString());case 16:throw t.t1;case 17:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(r){return t.apply(this,arguments)}}()},{key:"executeSale",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(v.O$.from(r));case 2:return e=t.sent,t.prev=3,t.next=6,this.getWinningBid(r);case 6:return n=t.sent,(0,x.Z)(n,"No winning bid found"),a=this.encoder.encode("collectAuctionPayout",[r]),i=this.encoder.encode("collectAuctionTokens",[r]),t.next=12,this.contractWrapper.multiCall([a,i]);case 12:return t.abrupt("return",t.sent);case 15:if(t.prev=15,t.t0=t.catch(3),!t.t0.message.includes("Marketplace: auction still active.")){t.next=21;break}throw new p.bk(r.toString(),e.endTimeInSeconds.toString());case 21:throw t.t0;case 22:case"end":return t.stop()}}),t,this,[[3,15]])})));return function(r){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAuction(r);case 2:return t.abrupt("return",t.sent.bidBufferBps);case 3:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getMinimumNextBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a,i,c,o,u,d;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Promise,t.t1=this.getBidBufferBps(r),t.t2=this.getWinningBid(r),t.next=5,this.validateAuction(v.O$.from(r));case 5:return t.t3=t.sent,t.t4=[t.t1,t.t2,t.t3],t.next=9,t.t0.all.call(t.t0,t.t4);case 9:return e=t.sent,a=(0,n.Z)(e,3),i=a[0],c=a[1],o=a[2],u=c?v.O$.from(c.bidAmount):v.O$.from(o.minimumBidAmount),d=u.add(u.mul(i).div(1e4)),t.abrupt("return",(0,p.aZ)(this.contractWrapper.getProvider(),o.currencyContractAddress,d));case 17:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getAuction(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the auction with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapAuction",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=p.aV.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=v.O$.from(r.startTimestamp).gt(a)?p.aV.Created:v.O$.from(r.endTimestamp).lt(a)?p.aV.Expired:p.aV.Active,t.abrupt("break",14);case 10:return e=p.aV.Completed,t.abrupt("break",14);case 12:return e=p.aV.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.auctionId.toString(),t.t2=r.auctionCreator,t.t3=r.assetContract,t.t4=r.tokenId.toString(),t.t5=r.quantity.toString(),t.t6=r.currency,t.t7=r.minimumBidAmount.toString(),t.next=23,(0,p.aZ)(this.contractWrapper.getProvider(),r.currency,r.minimumBidAmount);case 23:return t.t8=t.sent,t.t9=r.buyoutBidAmount.toString(),t.next=27,(0,p.aZ)(this.contractWrapper.getProvider(),r.currency,r.buyoutBidAmount);case 27:return t.t10=t.sent,t.t11=v.O$.from(r.timeBufferInSeconds).toNumber(),t.t12=v.O$.from(r.bidBufferBps).toNumber(),t.t13=v.O$.from(r.startTimestamp).toNumber(),t.t14=v.O$.from(r.endTimestamp).toNumber(),t.next=34,(0,p.cO)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 34:return t.t15=t.sent,t.t16=e,t.abrupt("return",{id:t.t1,creatorAddress:t.t2,assetContractAddress:t.t3,tokenId:t.t4,quantity:t.t5,currencyContractAddress:t.t6,minimumBidAmount:t.t7,minimumBidCurrencyValue:t.t8,buyoutBidAmount:t.t9,buyoutCurrencyValue:t.t10,timeBufferInSeconds:t.t11,bidBufferBps:t.t12,startTimeInSeconds:t.t13,endTimeInSeconds:t.t14,asset:t.t15,status:t.t16});case 37:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"mapBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n,a){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r,t.t1=e,t.t2=n,t.t3=a,t.next=6,(0,p.aZ)(this.contractWrapper.getProvider(),n,a);case 6:return t.t4=t.sent,t.abrupt("return",{auctionId:t.t0,bidderAddress:t.t1,currencyContractAddress:t.t2,bidAmount:t.t3,bidAmountCurrencyValue:t.t4});case 8:case"end":return t.stop()}}),t,this)})));return function(r,e,n,a){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(t,r){var e=(0,a.Z)(t);return r&&(r.seller&&(e=e.filter((function(t){var e;return t.auctionCreator.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.seller)||void 0===e?void 0:e.toString().toLowerCase())}))),r.tokenContract&&(e=e.filter((function(t){var e;return t.assetContract.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.tokenContract)||void 0===e?void 0:e.toString().toLowerCase())}))),void 0!==r.tokenId&&(e=e.filter((function(t){var e;return t.tokenId.toString()===(null===r||void 0===r||null===(e=r.tokenId)||void 0===e?void 0:e.toString())})))),null!==r&&void 0!==r&&r.count&&r.count<e.length?e.slice(0,r.count):e}}]),t}(),C=d.z.object({assetContractAddress:p.cF,tokenId:p.cG,quantity:p.cG.default(1),currencyContractAddress:p.cF.default(p.c2),totalPrice:u.A,endTimestamp:p.cI}),W=function(){function t(r,e){(0,c.Z)(this,t),(0,u._)(this,"featureName",p.cR.name),(0,u._)(this,"contractWrapper",void 0),(0,u._)(this,"storage",void 0),(0,u._)(this,"events",void 0),(0,u._)(this,"interceptor",void 0),(0,u._)(this,"encoder",void 0),this.contractWrapper=r,this.storage=e,this.events=new p.aM(this.contractWrapper),this.encoder=new p.aa(r),this.interceptor=new p.aN(this.contractWrapper)}return(0,o.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.readContract.address}},{key:"getTotalCount",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.totalOffers();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No offers exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllOffers);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapOffer(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=v.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No offers exist on the contract.");case 7:return i=[],t.next=10,(0,p.cK)(n,a,this.contractWrapper.readContract.getAllValidOffers);case 10:return c=t.sent,i=c.flat(),o=this.applyFilter(i,r),t.next=15,Promise.all(o.map((function(t){return u.mapOffer(t)})));case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.readContract.getOffer(r);case 2:return e=t.sent,t.next=5,this.mapOffer(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"makeOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=C.parse(r),t.next=3,this.contractWrapper.getChainID();case 3:return n=t.sent,a=(0,p.cE)(e.currencyContractAddress)?p.c3[n].wrapped.address:e.currencyContractAddress,t.next=7,(0,p.a$)(this.contractWrapper.getProvider(),e.totalPrice,a);case 7:return i=t.sent,t.next=10,this.contractWrapper.getCallOverrides();case 10:return c=t.sent,t.next=13,(0,p.cN)(this.contractWrapper,i,a,c);case 13:return t.next=15,this.contractWrapper.sendTransaction("makeOffer",[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:a,totalPrice:i,expirationTimestamp:e.endTimestamp}],{gasLimit:5e5});case 15:return o=t.sent,u=this.contractWrapper.parseLogs("NewOffer",null===o||void 0===o?void 0:o.logs),t.abrupt("return",{id:u[0].args.offerId,receipt:o});case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"cancelOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.sendTransaction("cancelOffer",[r]);case 2:return t.t0=t.sent,t.abrupt("return",{receipt:t.t0});case 4:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"acceptOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateOffer(v.O$.from(r));case 2:return e=t.sent,t.next=5,this.isStillValidOffer(e);case 5:if(n=t.sent,a=n.valid,i=n.error,a){t.next=10;break}throw new Error("Offer ".concat(r," is no longer valid. ").concat(i));case 10:return t.next=12,this.contractWrapper.getCallOverrides();case 12:if(t.t0=t.sent,t.t0){t.next=15;break}t.t0={};case 15:return c=t.t0,t.t1=p.cL,t.t2=this.contractWrapper,t.t3=this.getAddress(),t.t4=e.assetContractAddress,t.t5=e.tokenId,t.next=23,this.contractWrapper.getSignerAddress();case 23:return t.t6=t.sent,t.next=26,(0,t.t1)(t.t2,t.t3,t.t4,t.t5,t.t6);case 26:return t.next=28,this.contractWrapper.sendTransaction("acceptOffer",[r],c);case 28:return t.t7=t.sent,t.abrupt("return",{receipt:t.t7});case 30:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getOffer(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the offer with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=p.aV.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=v.O$.from(r.expirationTimestamp).lt(a)?p.aV.Expired:p.aV.Active,t.abrupt("break",14);case 10:return e=p.aV.Completed,t.abrupt("break",14);case 12:return e=p.aV.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.offerId.toString(),t.t2=r.offeror,t.t3=r.assetContract,t.t4=r.currency,t.t5=r.tokenId.toString(),t.t6=r.quantity.toString(),t.t7=r.totalPrice.toString(),t.next=23,(0,p.aZ)(this.contractWrapper.getProvider(),r.currency,r.totalPrice);case 23:return t.t8=t.sent,t.next=26,(0,p.cO)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 26:return t.t9=t.sent,t.t10=v.O$.from(r.expirationTimestamp).toNumber(),t.t11=e,t.abrupt("return",{id:t.t1,offerorAddress:t.t2,assetContractAddress:t.t3,currencyContractAddress:t.t4,tokenId:t.t5,quantity:t.t6,totalPrice:t.t7,currencyValue:t.t8,asset:t.t9,endTimeInSeconds:t.t10,status:t.t11});case 30:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v.O$.from(Math.floor(Date.now()/1e3)).gt(r.endTimeInSeconds)){t.next=3;break}return t.abrupt("return",{valid:!1,error:"Offer with ID ".concat(r.id," has expired")});case 3:return t.next=5,this.contractWrapper.getChainID();case 5:return e=t.sent,n=(0,p.cE)(r.currencyContractAddress)?p.c3[e].wrapped.address:r.currencyContractAddress,a=this.contractWrapper.getProvider(),i=new p.cz(a,n,y,{}),t.next=11,i.readContract.balanceOf(r.offerorAddress);case 11:if(!t.sent.lt(r.totalPrice)){t.next=14;break}return t.abrupt("return",{valid:!1,error:"Offeror ".concat(r.offerorAddress," doesn't have enough balance of token ").concat(n)});case 14:return t.next=16,i.readContract.allowance(r.offerorAddress,this.getAddress());case 16:if(!t.sent.lt(r.totalPrice)){t.next=19;break}return t.abrupt("return",{valid:!1,error:"Offeror ".concat(r.offerorAddress," hasn't approved enough amount of token ").concat(n)});case 19:return t.abrupt("return",{valid:!0,error:""});case 20:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(t,r){var e=(0,a.Z)(t);return r&&(r.offeror&&(e=e.filter((function(t){var e;return t.offeror.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.offeror)||void 0===e?void 0:e.toString().toLowerCase())}))),r.tokenContract&&(e=e.filter((function(t){var e;return t.assetContract.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.tokenContract)||void 0===e?void 0:e.toString().toLowerCase())}))),void 0!==r.tokenId&&(e=e.filter((function(t){var e;return t.tokenId.toString()===(null===r||void 0===r||null===(e=r.tokenId)||void 0===e?void 0:e.toString())})))),null!==r&&void 0!==r&&r.count&&r.count<e.length?e.slice(0,r.count):e}}]),t}(),O=function(){function t(r,e,n){(0,c.Z)(this,t);var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new p.cz(r,e,s,a);(0,u._)(this,"abi",void 0),(0,u._)(this,"contractWrapper",void 0),(0,u._)(this,"storage",void 0),(0,u._)(this,"encoder",void 0),(0,u._)(this,"events",void 0),(0,u._)(this,"estimator",void 0),(0,u._)(this,"platformFees",void 0),(0,u._)(this,"metadata",void 0),(0,u._)(this,"roles",void 0),(0,u._)(this,"interceptor",void 0),(0,u._)(this,"_chainId",void 0),this._chainId=i,this.abi=s,this.contractWrapper=o,this.storage=n,this.metadata=new p.ab(this.contractWrapper,p.cC,this.storage),this.roles=new p.ac(this.contractWrapper,t.contractRoles),this.encoder=new p.aa(this.contractWrapper),this.estimator=new p.aL(this.contractWrapper),this.events=new p.aM(this.contractWrapper),this.platformFees=new p.aO(this.contractWrapper),this.interceptor=new p.aN(this.contractWrapper)}return(0,o.Z)(t,[{key:"directListings",get:function(){return(0,p.bO)(this.detectDirectListings(),p.cJ)}},{key:"englishAuctions",get:function(){return(0,p.bO)(this.detectEnglishAuctions(),p.cQ)}},{key:"offers",get:function(){return(0,p.bO)(this.detectOffers(),p.cR)}},{key:"chainId",get:function(){return this._chainId}},{key:"onNetworkUpdated",value:function(t){this.contractWrapper.updateSignerOrProvider(t)}},{key:"getAddress",value:function(){return this.contractWrapper.readContract.address}},{key:"call",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c=arguments;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=c.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=c[i];return t.abrupt("return",(e=this.contractWrapper).call.apply(e,[r].concat(a)));case 2:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"detectDirectListings",value:function(){if((0,p.bP)(this.contractWrapper,"DirectListings"))return new b(this.contractWrapper,this.storage)}},{key:"detectEnglishAuctions",value:function(){if((0,p.bP)(this.contractWrapper,"EnglishAuctions"))return new A(this.contractWrapper,this.storage)}},{key:"detectOffers",value:function(){if((0,p.bP)(this.contractWrapper,"Offers"))return new W(this.contractWrapper,this.storage)}}]),t}();(0,u._)(O,"contractRoles",["admin","lister","asset"])}}]);
//# sourceMappingURL=974.f78c67ff.chunk.js.map